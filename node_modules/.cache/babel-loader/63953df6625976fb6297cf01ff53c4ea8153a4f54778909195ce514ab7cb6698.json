{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CloneType = exports.Optional = exports.Type = void 0;\nexports.Validate = Validate;\nexports.Assert = Assert;\nexports.AssertWeak = AssertWeak;\nconst typebox_1 = require(\"@sinclair/typebox\");\nObject.defineProperty(exports, \"Optional\", {\n  enumerable: true,\n  get: function () {\n    return typebox_1.Optional;\n  }\n});\nObject.defineProperty(exports, \"CloneType\", {\n  enumerable: true,\n  get: function () {\n    return typebox_1.CloneType;\n  }\n});\nconst errors_1 = require(\"@sinclair/typebox/errors\");\nconst ts_mixer_1 = require(\"ts-mixer\");\nconst custom_types_1 = require(\"./custom-types\");\nconst errors_2 = require(\"./errors\");\nconst utils_1 = require(\"./utils\");\nclass CustomTypeBuilder extends (0, ts_mixer_1.Mixin)(typebox_1.JavaScriptTypeBuilder, custom_types_1.ArrayBufferBuilder, custom_types_1.BufferBuilder, custom_types_1.KeyofEnumBuilder, custom_types_1.UintBuilder) {}\nfunction Validate(schema, value) {\n  try {\n    Assert(schema, value);\n    return true;\n  } catch (_a) {\n    return false;\n  }\n}\nfunction FindErrorInUnion(error) {\n  const currentValue = error.value;\n  const unionMembers = error.schema.anyOf;\n  const hasValidMember = unionMembers.find(unionSchema => Validate(unionSchema, currentValue));\n  if (!hasValidMember) {\n    const possibleMatchesByLiterals = unionMembers.filter(unionSchema => {\n      if (unionSchema[typebox_1.Kind] !== 'Object') return false;\n      return !Object.entries(unionSchema.properties).find(_ref => {\n        let [property, propertySchema] = _ref;\n        return propertySchema.const && propertySchema.const !== currentValue[property];\n      });\n    });\n    if (possibleMatchesByLiterals.length === 1) {\n      Assert(possibleMatchesByLiterals[0], currentValue);\n    } else if (possibleMatchesByLiterals.length > 1) {\n      const errorsOfPossibleMatches = possibleMatchesByLiterals.map(matchSchema => ({\n        schema: matchSchema,\n        errors: [...(0, errors_1.Errors)(matchSchema, currentValue)]\n      }));\n      const sortedErrors = errorsOfPossibleMatches.sort((a, b) => a.errors.length - b.errors.length);\n      const [bestMatch] = sortedErrors;\n      Assert(bestMatch.schema, currentValue);\n    }\n    throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n  }\n}\nfunction Assert(schema, value) {\n  const errors = [...(0, errors_1.Errors)(schema, value)];\n  let [error] = errors;\n  while (error) {\n    if (error.path === '/' && errors.length > 1) {} else if (error.value == null && error.schema[typebox_1.OptionalKind] === 'Optional') {} else if (error.type === errors_1.ValueErrorType.Union) {\n      FindErrorInUnion(error);\n    } else if (error.type === errors_1.ValueErrorType.Number && typeof error.value === 'string') {\n      const currentValue = error.value;\n      const parsedNumber = Number(currentValue);\n      if (!Number.isNaN(parsedNumber) && currentValue === parsedNumber.toString()) {\n        const pathParts = error.path.slice(1).split('/');\n        (0, utils_1.setDeepValue)(value, pathParts, parsedNumber);\n      } else {\n        throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n      }\n    } else {\n      throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n    }\n    errors.shift();\n    [error] = errors;\n  }\n}\nfunction AssertWeak(schema, value) {\n  try {\n    Assert(schema, value);\n  } catch (e) {\n    if (e instanceof errors_2.InvalidParameter) {\n      if (e.type === errors_1.ValueErrorType.ObjectRequiredProperty) {\n        throw e;\n      }\n      console.warn('Method params validation failed', e);\n    } else {\n      throw e;\n    }\n  }\n}\nexports.Type = new CustomTypeBuilder();","map":{"version":3,"names":["exports","Validate","Assert","AssertWeak","typebox_1","require","Object","defineProperty","enumerable","get","Optional","CloneType","errors_1","ts_mixer_1","custom_types_1","errors_2","utils_1","CustomTypeBuilder","Mixin","JavaScriptTypeBuilder","ArrayBufferBuilder","BufferBuilder","KeyofEnumBuilder","UintBuilder","schema","value","_a","FindErrorInUnion","error","currentValue","unionMembers","anyOf","hasValidMember","find","unionSchema","possibleMatchesByLiterals","filter","Kind","entries","properties","_ref","property","propertySchema","const","length","errorsOfPossibleMatches","map","matchSchema","errors","Errors","sortedErrors","sort","a","b","bestMatch","InvalidParameter","message","path","type","OptionalKind","ValueErrorType","Union","Number","parsedNumber","isNaN","toString","pathParts","slice","split","setDeepValue","shift","e","ObjectRequiredProperty","console","warn","Type"],"sources":["../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}